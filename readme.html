<!-- File: readme.html
  Copyright (c) 2020-2021 Splunk Inc.

  Licensed under Apache 2.0 (https://www.apache.org/licenses/LICENSE-2.0.txt)
-->
<html>
    <head>
    </head>
    <body>
        <h2>Port Information</h2>
        <p>
            The app uses HTTP/ HTTPS protocol for communicating with the Tanium server. Below are the default ports used by Splunk SOAR.
            <table>
                <tr class=plain>
                    <th>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Service Name</th>
                    <th>Transport Protocol</th>
                    <th>Port</th>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;http</td>
                    <td>tcp</td>
                    <td>80</td>
                </tr>
                <tr>
                    <td>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;https</td>
                    <td>tcp</td>
                    <td>443</td>
                </tr>
            </table>
        </p>

        <h2>Asset Configuration</h2>
        <li><b>API Token</b></li>
        <ul>
        <li>An API token can be used for authentication in place of the basic auth method of username and password. If the asset is configured with <b>both</b> API token and username/password credentials, the token will be used as the preferred method. However for security purposes, once the token has expired or if it is invalid, the app will <b>NOT</b> revert to basic auth credentials - the token must either be removed from or replaced in the asset config.
        </li>
        </ul>
        </ul>
<h2>API Token Generation</h2>
<ul>
  <li>There are different methods of creating an API token depending on which version of Tanium is being used. Later versions allow token generation through the UI, while earlier versions require the use of curl commands.
</li>
<li><b>IMPORTANT: The default expiration of a generated token is 7 days. To reduce maintenance, we recommend setting the default expiration to 365 days. Note that you will have to repeat this process to generate a new token before the current token expires. Failure to do so will cause integration to break as your token will no longer be valid after such date.</b>
</li>
<li><b>The end user will need to add the SOAR source IP address as a "Trusted IP Address" when creating a Tanium API Token. They will also need to note the expiration time and create a new token accordingly.</b>
</li>
<li><b>The following information regarding API calls using curl commands and additional notes have been taken from the "Tanium Server REST API Reference" documentation. More information can be gathered by contacting Tanium Support.</b>
</li>

  <h3>UI</h3>
    <li>To generate an API token in the UI and to configure the system to use it, please follow the steps mentioned in this <a href="https://docs.tanium.com/platform_user/platform_user/console_api_tokens.html" target="_blank">documentation</a>. On Tanium 7.5.2.3503, new API tokens can be generated by selecting Administration > Permissions > API Tokens > New API Token. Depending on the version of Tanium, the UI may not contain the token creation button on the page and will only display a list of the existing API tokens. If this is the case, you will need to use the curl command method.</li>

  <h3>Curl</h3>
    <li>To generate an API token using this method, a session string or token string will need to be acquired first through the Login API endpoint. Then, the session or token string will be passed in the header to get the API token. In the examples below, fields need to be passed in the API token request. <b>You MUST include the SOAR IP address as a trusted IP address.</b> It is also useful to include the <b>notes</b> field, as this can be useful in identifying the token after it is created since the token string is not visible in the UI using this method.</li>
    <li><h4>Login API Endpoint</h4></li>
    <code>/api/v2/session/login</code>
    <h4>Example Request</h4>
    <code>
    $ curl -s -X POST --data-binary @sample_login.json https://localhost/api/v2/session/login
      <pre>
      # where sample_login.json contains:
      # {
      #   "username": "jane.doe",
      #   "domain": "dev",
      #   "password": "JanesPassword" <!-- pragma: allowlist secret -->
      # }
      </pre>
    </code>
    <h4>Example Response</h4>
      <code>
        <pre>
      {
        "data": {
            "session": "1-224-3cb8fe975e0b505045d55584014d99f6510c110d19d0708524c1219dbf717535"
            }
      }
        </pre>
      </code>
      <li><h4>Token API Endpoint</h4></li>
      <code>/api/v2/api_tokens</code>
      <h4>Example Request (session string):</h4>
      <code>
      $ curl -s -X POST -H "session:{string}" --data "{json object}" https://localhost/api/v2/api_tokens
      </code>
      <h4>Header Parameters</h4>
      <table>
      <tr><th>Field</th><th>Type</th><th>Description</th></tr>
      <tr><td>session</td><td>string</td><td>(Required) The Tanium session or token string. The session string is returned by the Log In and Validate routes.</td></tr>
      </table>
      <h4>Body Parameters</h4>
      <table>
      <tr><th>Field</th><th>Type</th><th>Description</th></tr>
      <tr><td>object</td><td>application/json</td><td>(Required) A json object containing fields "expire_in_days", "notes", and "trusted_ip_addresses". Be sure that the SOAR IP address is included in the "trusted_ip_addresses" field. </td></tr>
      </table>

      <h4>Example Request (with fields):</h4>
      <code>
      $ curl -s -X POST -H "session:{string}" --data-binary @new_token.json https://localhost/api/v2/api_tokens
        <pre>
      # where new_token.json contains:
      # {
      #   "expire_in_days": 365,
      #   "notes": "My module token.",
      #   "trusted_ip_addresses": "10.10.10.15,192.168.3.0/24"
      # }
        </pre>
      </code>
</ul>

        <h2>Tanium Threat Response Typical Usage Example</h2>
        <p>
            To get the information from Tanium Threat Response, you will need to follow a certain flow of actions
            to get what you want. First, you will need to run a search to find the computer that Threat Response can interact
            with. To get that you can run the <code>list computers</code> action to search through the computers that
            are connected to Threat Response. You will get back the top 10 computers that match a search query, so being as
            specific as possible would be better.
        </p>
        <p>
            Once you find the computer that you want to collect information from, you need to create a connection using
            the <code>create connection</code> action, where the name returned from the <code>list computers</code> is used.
            Otherwise, the connection may take a while and fail. This action only sends the request to create the
            connection and will not return the status of that connection.
        </p>
        <p>
            You can then test to see if your connection was made by running <code>get connection</code>. It will list
            the status of all the current connections. An <b>active</b> status means you can run the other actions to
            get information that you may need. Live connections will timeout and need to be recreated in those cases.
            Connections to snapshots will stay open and should be closed after everything is completed.
        </p>
        <p>
            You can get the list of all the snapshots by running the <code>list snapshots</code> action. It will list all the
            snapshots, i.e., the snapshot files that are uploaded manually and the snapshots that are captured through Tanium UI.
            The <code>list local snapshots</code> action lists only those snapshots which are captured through Tanium UI. Also,
            the endpoint used in the <code>list local snapshots</code> action will be deprecated in the future so we would suggest
            you use the <code>list snapshots</code> action instead of the <code>list local snapshots</code> action.
        </p>
        <p>
            To delete a snapshot, you can run the <code>delete snapshot</code> action by providing the <b>host</b> and the
            <b>filename</b>. The <code>delete local snapshot</code> action does not work as per the expectation, as the status
            of the deleted snapshot does not get reflected on the UI. Hence, we would suggest you use the <code>delete
            snapshot</code> action instead of the <code>delete local snapshot</code> action.
        </p>
    </body>
</html>
